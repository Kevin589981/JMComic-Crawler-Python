# JMComic 漫画下载配置说明

## 配置功能
根据你的要求，已配置以下功能：
- ✅ 下载完整本后自动转为PDF
- ✅ 保存到指定目录：`D:\文档\DOWNLOADS\漫画`
- ✅ 使用移动端客户端实现（不限IP，兼容性好）

## 安装依赖

在使用前，请确保安装了必要的依赖：

```bash
# 安装 jmcomic
pip install jmcomic -i https://pypi.org/project -U

# 安装 PDF 转换依赖
pip install img2pdf
```

## 使用方法

### 方法1：使用Python脚本
1. 修改 `download_manga.py` 中的 `album_id` 为你想要的本子ID
2. 运行脚本：
```bash
python download_manga.py
```

### 方法2：使用命令行
```bash
# 设置环境变量指向配置文件
setx JM_OPTION_PATH "option.yml"

# 重启命令行后，直接下载
jmcomic 422866
```

### 方法3：直接使用Python代码
```python
import jmcomic

# 创建配置对象
option = jmcomic.create_option_by_file('option.yml')

# 下载本子
jmcomic.download_album('422866', option)
```

## 文件结构

下载完成后，文件将按以下结构保存：

```
D:\文档\DOWNLOADS\漫画\
├── [本子标题]\
│   └── [章节标题]\
│       ├── 001.jpg
│       ├── 002.jpg
│       └── ...
└── PDF\
    └── [本子标题].pdf
```

## 配置说明

### 客户端配置
- `impl: api` - 使用移动端API，不限IP地区，兼容性好
- `retry_times: 5` - 请求失败时重试5次

### 下载配置
- `cache: true` - 启用缓存，避免重复下载
- `decode: true` - 自动解码JM的图片混淆
- `threading.image: 30` - 同时下载30张图片
- `threading.photo: 16` - 同时下载16个章节

### 路径配置
- `base_dir: D:/文档/DOWNLOADS/漫画/` - 图片保存根目录
- `rule: Bd_Atitle_Ptitle` - 文件夹规则：根目录/本子标题/章节标题

### PDF插件配置
- `pdf_dir: D:/文档/DOWNLOADS/漫画/PDF/` - PDF保存目录
- `filename_rule: Atitle` - PDF文件名使用本子标题
- 整个本子会合并为一个PDF文件

## 高级配置

### 添加PDF密码保护
在 `option.yml` 中取消注释并修改：
```yaml
encrypt:
  password: 你的密码
```

### 修改下载路径
修改 `option.yml` 中的 `base_dir` 和 `pdf_dir`

### 添加代理
如果需要使用代理，修改：
```yaml
proxies: 127.0.0.1:7890
```

### 登录配置
如果需要下载需要登录的本子，添加cookies：
```yaml
cookies:
  AVS: 你的AVS_cookie值
```

## 注意事项

1. **依赖安装**：确保已安装 `img2pdf` 库
2. **目录权限**：确保对目标目录有写入权限
3. **网络连接**：移动端API对网络要求较低，但仍需稳定连接
4. **合理使用**：请不要一次性下载太多本子，减轻服务器压力
5. **本子ID获取**：从JM网站URL中获取，例如 `https://xxx.com/album/422866/` 中的 `422866`

## 故障排除

### 下载失败
- 检查网络连接
- 确认本子ID正确
- 检查目录权限

### PDF生成失败
- 确认已安装 `img2pdf`：`pip install img2pdf`
- 检查PDF目录是否存在写入权限

### 图片解码失败
- 确认 `decode: true` 配置正确
- 检查是否为最新版本的 jmcomic